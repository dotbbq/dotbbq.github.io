<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>dir505 on UNIXETC</title>
    <link>https://unixetc.com/tags/dir505/</link>
    <description>UNIXETC (dir505)</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh</language>
    <lastBuildDate>Fri, 20 Nov 2015 11:20:00 +0000</lastBuildDate>
    
    <atom:link href="https://unixetc.com/tags/dir505/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>打造一台翻墙路由器[转载]</title>
      <link>https://unixetc.com/post/dir-505-openwrt-shadowsocks-chinadns/</link>
      <pubDate>Fri, 20 Nov 2015 11:20:00 +0000</pubDate>
      
      <guid>https://unixetc.com/post/dir-505-openwrt-shadowsocks-chinadns/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;本文转载自&lt;a href=&#34;https://github.com/Jerry-hechen/blog&#34;&gt;https://github.com/Jerry-hechen/blog&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;路由器配置方案：Shadowsocks-libev-spec + ChinaDNS&lt;/p&gt;
&lt;p&gt;本教程以Dlink dir-505为例，其他型号路由也类似，Openwrt版本：15.05，其他安装包均为最新版。&lt;/p&gt;
&lt;p&gt;首先路由器型号需要在openwrt列表中：&lt;a href=&#34;http://wiki.openwrt.org/toh/start&#34;&gt;http://wiki.openwrt.org/toh/start&lt;/a&gt;(可以ctrl+F搜索匹配型号)，并记录所用路由器cpu的型号。&lt;/p&gt;
&lt;h3 id=&#34;一下载路由器cpu型号对应的的固件httpsdownloadsopenwrtorg&#34;&gt;一.下载路由器CPU型号对应的的固件：&lt;a href=&#34;https://downloads.openwrt.org/&#34;&gt;https://downloads.openwrt.org/&lt;/a&gt;&lt;/h3&gt;
&lt;h3 id=&#34;二刷机及配置&#34;&gt;二.刷机及配置&lt;/h3&gt;
&lt;p&gt;1.访问路由器上传固件，等待一会儿，勿断电。&lt;/p&gt;
&lt;p&gt;2.好了之后打开wifi开关，连上openwrt（有的固件默认不没有开启WI-FI需要用网线连接），访问192.168.1.1&lt;/p&gt;
&lt;p&gt;3.System－》Administertion，设置路由密码，选中Allow remote hosts to connect to local SSH forwarded ports&lt;/p&gt;
&lt;p&gt;4.Network－》Wifi，WI-FI没有启动先启动，设置Transmit Power为15dBm（31mW），设置Country Code为CN-China&lt;/p&gt;
&lt;p&gt;5.设置下WIFI名称（ESSID）、密码、加密方式（Encryption,推荐使用WPA-PSK/WPA2-PSK）&lt;/p&gt;
&lt;p&gt;6.Network－》Interfaces，修改LAN口，勾掉Bridge interfaces选项，更改网关为192.168.5.1，添加WAN口选择DHCP client选项（如果需要拨号选择PPPoE）,勾上Adapter “eth1”。注意：此处修改LAN口、添加WAN口不要“保存&amp;amp;应用”，先“保存”，在Network－》Interfaces列表整体“保存&amp;amp;应用”&lt;/p&gt;
&lt;p&gt;为了和主路由不冲突最好将网关改为其他，比如192.168.5.1&lt;/p&gt;
&lt;p&gt;刷机成功。&lt;/p&gt;
&lt;h3 id=&#34;三下载安装包并安装到路由器&#34;&gt;三.下载安装包并安装到路由器&lt;/h3&gt;
&lt;h4 id=&#34;1下载安装包&#34;&gt;1.下载安装包&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;Shadowsocks-spec: http://sourceforge.net/projects/openwrt-dist/files/shadowsocks-libev/
chinaDNS: chinaDNS: http://sourceforge.net/projects/openwrt-dist/files/chinadns/
Shadowsocks-spec-LuCI：http://sourceforge.net/projects/openwrt-dist/files/luci-app/shadowsocks-spec/
chinaDNS-LuCI：http://sourceforge.net/projects/openwrt-dist/files/luci-app/chinadns/
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;注意，一定要下载路由器cpu型号对应的文件！DIR-505选择ar71xx&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;2安装到路由器&#34;&gt;2.安装到路由器&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;保证路由器可以上外网&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;用ssh工具上传shadowsocks-libev-spec、ChinaDNS、及2个luci文件 4个ipk包到路由器/tmp目录&lt;/p&gt;
&lt;p&gt;ssh &lt;a href=&#34;mailto:root@192.168.5.1&#34;&gt;root@192.168.5.1&lt;/a&gt;
opkg update&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;安装中文包，然后在路由管理界面System－》System－》Language and Style切换中文语音，刷新可看到中文&lt;/p&gt;
&lt;p&gt;opkg install luci-i18n-base-zh-cn&lt;/p&gt;
&lt;p&gt;cd /tmp&lt;/p&gt;
&lt;p&gt;opkg install shadowsocks-libev-spec-polarssl_2.4.1-1_ar71xx.ipk&lt;/p&gt;
&lt;p&gt;opkg install ChinaDNS_1.3.2-3_ar71xx.ipk&lt;/p&gt;
&lt;p&gt;opkg install luci-app-shadowsocks-spec_1.3.2-1_all.ipk&lt;/p&gt;
&lt;p&gt;opkg install luci-app-chinadns_1.3.4-1_all.ipk&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;期间可能会遇到错误提示,没关系，这时因为安装ipset包后需要重启。&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;3更改配置路由管理界面&#34;&gt;3.更改配置（路由管理界面）&lt;/h4&gt;
&lt;p&gt;网络－》DHCP/DNS&lt;/p&gt;
&lt;p&gt;基本设置里将 本地服务器 更改为 127.0.0.1#5353&lt;/p&gt;
&lt;p&gt;HOSTS和解析文件里 勾选 忽略解析文件和忽略HOSTS文件&lt;/p&gt;
&lt;p&gt;服务－》ChinaDNS里 ChinaDNS上游服务器更改为 114.114.114.114,127.0.0.1:5300 (适合服务器支持UDP转发，较新版本Shadowsocks均支持)&lt;/p&gt;
&lt;p&gt;服务－》ShadowSocks 全局设置中输入S’s账号（先启用，S’s账号需要和服务配置匹配），代理设置中更改代理方式为“忽略列表”&lt;/p&gt;
&lt;h3 id=&#34;四设置自动更新忽略配置文件&#34;&gt;四.设置自动更新忽略配置文件。&lt;/h3&gt;
&lt;p&gt;敌人的策略一直在变化，为了实现智能分流需要设置自动更新忽略配置文件，长时间不更新可能导致部分国内网站走代理或者国外不走代理，如下：&lt;/p&gt;
&lt;p&gt;1.手动建立文件夹, shadowsocks忽略配置用到&lt;/p&gt;
&lt;p&gt;mkdir /etc/shadowsocks&lt;/p&gt;
&lt;p&gt;2.新建 vi /root/update.sh，内容如下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;#!/bin/sh

ping -c2 www.baidu.com &amp;gt;&amp;gt;/dev/null
if [ $? -eq 0 ];then
    wget -O- &#39;http://ftp.apnic.net/apnic/stats/apnic/delegated-apnic-latest&#39; | awk -F\| &#39;/CN\|ipv4/ { printf(&amp;quot;%s/%d\n&amp;quot;, $4, 32-log($5)/log(2)) }&#39; &amp;gt; /etc/shadowsocks/ignore.list
    wget -O- &#39;http://ftp.apnic.net/apnic/stats/apnic/delegated-apnic-latest&#39; | awk -F\| &#39;/CN\|ipv4/ { printf(&amp;quot;%s/%d\n&amp;quot;, $4, 32-log($5)/log(2)) }&#39; &amp;gt; /etc/chinadns_chnroute.txt
else
        echo &#39;network is down...&#39;
fi
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;3.然后用命令给予该脚本执行权限并执行，正常的话配置文件会成功更新&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;chmod +x /root/update.sh
/root/update.sh
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;4.在路由器，管理界面点击“系统”→“计划任务”中，输入以下内容：&lt;/p&gt;
&lt;p&gt;30 4 * * * /root/update.sh&lt;/p&gt;
&lt;p&gt;保存后，每天的凌晨4点半就会自动执行这个更新脚本了。&lt;/p&gt;
&lt;p&gt;5.重启路由器，系统－》重启&lt;/p&gt;
&lt;p&gt;翻墙成功!&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>