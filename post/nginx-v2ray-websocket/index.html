<!DOCTYPE html>


<html lang="zh-cn" data-theme="">
<head>
    
        
<meta charset="utf-8">
<meta name="HandheldFriendly" content="True">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer-when-downgrade">

<title>Nginx V2ray and WebSocket - UNIXETC</title>
<meta name="description" content="A Personal Site">

<link rel="icon" type="image/x-icon" href="https://unixetc.com/favicon.ico">
<link rel="apple-touch-icon-precomposed" href="https://unixetc.com/favicon.png">

<link rel="stylesheet" href="https://unixetc.com/css/light.css?rnd=1596103619" />
<style>

    [data-theme="dark"] {   
        --font-color: #eee;
--bg-color: #212121;

--link-color:#599ada;
--link-state-color:#ff5858;
--link-state-border-color: rgba(238, 54, 54, 0.5);

--thead-bg-color: #343a40;
--table-border-color: lightgrey;

--pre-color: #333;
--pre-bg-color: #f1f1f1;

--bq-color: #ccc;
--hr-color: #333;

--pagination-bg-color: #373737;
--pagination-link-color: #b6b6b6;

--post-info-color: grey;

--switcher-color: #333;
--switcher-bg-color: #fff;

    }

</style>

<link rel="stylesheet" href="https://unixetc.com/css/style.css?rnd=1596103619" />





<meta property="og:title" content="Nginx V2ray and WebSocket" />
<meta property="og:description" content="斐讯N1系统信息和UNIXBENCH跑分" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://unixetc.com/post/nginx-v2ray-websocket/" />
<meta property="article:published_time" content="2020-07-30T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-07-30T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Nginx V2ray and WebSocket"/>
<meta name="twitter:description" content="斐讯N1系统信息和UNIXBENCH跑分"/>








    
</head>
<body>
    <a class="skip-main" href="#main">Skip to main content</a>
    <div class="container">
        <header class="common-header"> 
            
                <h1 class="site-title">
    <a href="/">UNIXETC</a>
</h1>
<nav>
    
    
    <a class="" href="https://unixetc.com/tags/" title="">Tags</a>
    
    <a class="" href="https://unixetc.com/readme/" title="ReadMe">Readme</a>
    
</nav>

            
        </header>
        <main id="main" tabindex="-1"> 
            
    
    
    <article class="post">
        <header class="post-header">
            <h1 class="post-title">Nginx V2ray and WebSocket</h1>
        </header>
        <div class="content">
            <h3 id="安装v2raynginx">安装v2ray/nginx</h3>
<p>v2ray安装可以参考<a href="/post/v2ray-client-configuration-example-in-ubuntu/">Ubuntu中v2ray客户端配置实例</a>.</p>
<p>Nginx安装推荐使用<a href="https://oneinstack.com/">OneinStack一键安装脚本</a></p>
<p>准备好使用的域名，这里以<strong><code>v.fuckgfw.cn</code></strong>为例。</p>
<h3 id="v2raynginx服务端配置">v2ray/nginx服务端配置</h3>
<p>v2ray安装好后，服务端配置<strong><code>/etc/v2ray/config.json</code></strong>如下:</p>
<pre><code>{
	&quot;inbounds&quot;: [{
		&quot;port&quot;: 99999,  //代理端口号
		&quot;listen&quot;: &quot;127.0.0.1&quot;,
		&quot;protocol&quot;: &quot;vmess&quot;,
		&quot;settings&quot;: {
			&quot;clients&quot;: [{
				&quot;id&quot;: &quot;5c1eed18-fse4-41fs-9as9-e85s45bds9ef&quot;,
				&quot;level&quot;: 1,
				&quot;alterId&quot;: 64
			}]
		},
		&quot;streamSettings&quot;: {
			&quot;network&quot;: &quot;ws&quot;,
			&quot;wsSettings&quot;: {
				&quot;path&quot;: &quot;/fcgfw&quot; //代理目录
			}
		}
	}],
	&quot;outbounds&quot;: [{
		&quot;protocol&quot;: &quot;freedom&quot;,
		&quot;settings&quot;: {}
	}, {
		&quot;protocol&quot;: &quot;blackhole&quot;,
		&quot;settings&quot;: {},
		&quot;tag&quot;: &quot;blocked&quot;
	}],
	&quot;routing&quot;: {
		&quot;rules&quot;: [{
			&quot;type&quot;: &quot;field&quot;,
			&quot;ip&quot;: [&quot;geoip:private&quot;],
			&quot;outboundTag&quot;: &quot;blocked&quot;
		}]
	}
}
</code></pre><p>使用OneinStack一键脚本新建一个站点，域名为<code>v.fuckgfw.cn</code>，采用SSL加密模式，完成后编辑<strong><code>/usr/local/nginx/conf/vhost/v.fuckgfw.cn.conf</code></strong>文件</p>
<p>参考以下修改：</p>
<pre><code>server {
  listen 80;
  listen [::]:80;
  listen 443 ssl http2;
  listen [::]:443 ssl http2;
  ssl_certificate /usr/local/nginx/conf/ssl/v.fuckgfw.cn.crt;
  ssl_certificate_key /usr/local/nginx/conf/ssl/v.fuckgfw.cn.key;
  ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
  ssl_ciphers TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
  ssl_prefer_server_ciphers on;
  ssl_session_timeout 10m;
  ssl_session_cache builtin:1000 shared:SSL:10m;
  ssl_buffer_size 1400;
  add_header Strict-Transport-Security max-age=15768000;
  ssl_stapling on;
  ssl_stapling_verify on;
  server_name v.fuckgfw.cn;
  access_log off;
  if ($ssl_protocol = &quot;&quot;) { return 301 https://$host$request_uri; }

    location /fcgfw {       //与上面v2ray配置的代理目录一致                  
        proxy_redirect off;
        proxy_pass http://127.0.0.1:99999;       //与上面v2ray配置端口号一致 
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection &quot;upgrade&quot;;
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_connect_timeout 60s;
        proxy_read_timeout 86400s;
        proxy_send_timeout 60s;
    }
}

</code></pre><p>按照上面修改好<strong>nginx</strong>与<strong>v2ray</strong>配置后，重启服务。</p>
<pre><code>service nginx reload
service v2ray restart
</code></pre><h3 id="v2ray客户端配置">v2ray客户端配置</h3>
<p>以<strong>v2rayN</strong>为例</p>
<ul>
<li>地址:v.fuckgfw.cn</li>
<li>端口:443</li>
<li>用户ID:5c1eed18-fse4-41fs-9as9-e85s45bds9ef</li>
<li>额外ID:64</li>
<li>加密方式:auto</li>
<li>传输协议:ws</li>
<li>别名:v.fuckgfw.cn</li>
<li>伪装类型:none</li>
<li>伪装域名:v.fuckgfw.cn</li>
<li>路径:/fcgfw</li>
<li>底层传输安全:tls</li>
<li>跳过证书验证:false</li>
</ul>
<p><a href="https://unixetc.com/usr/uploads/nginx-v2ray-websocket.png">https://unixetc.com/usr/uploads/nginx-v2ray-websocket.png</a></p>

        </div>
        


<div class="post-info">
    
        <div class="post-date">2020-07-30</div>
    
    <div class="post-taxonomies">
        
            <ul class="post-categories">
                
                    <li><a href="https://unixetc.com/categories/STUFF">STUFF</a></li>
                
            </ul>
            
            
                <ul class="post-tags">
                    
                        <li><a href="https://unixetc.com/tags/vps">#VPS</a></li>
                    
                        <li><a href="https://unixetc.com/tags/linux">#Linux</a></li>
                    
                        <li><a href="https://unixetc.com/tags/nginx">#Nginx</a></li>
                    
                        <li><a href="https://unixetc.com/tags/v2ray">#V2ray</a></li>
                    
                        <li><a href="https://unixetc.com/tags/websocket">#WebSocket</a></li>
                    
                </ul>
        
    </div>
</div>

    </article>

    

    


        </main>
        
            <footer class="common-footer">
    
    

    <div class="copyright">
        <p>© Alair, 2020<br>
        Powered by <a target="_blank" rel="noopener noreferrer" href="https://gohugo.io/">Hugo</a>, theme <a target="_blank" rel="noopener noreferrer" href="https://github.com/mitrichius/hugo-theme-anubis">Anubis</a>.CDN by <a href="https://dwz.cn/juw2S2At" target="_blank">Qiniu</a>,Host by <a href="https://dwz.cn/CdAD0bNi" target="_blank">BWG</a>.<script type="text/javascript" src="//js.users.51.la/20892031.js"></script>
        </p>  
    </div> 

    


    
</footer>

        
    </div>
</body>
</html>
